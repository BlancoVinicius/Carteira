{% load static %}
<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Carteira{% endblock %}</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    {% block extra_css %}{% endblock %}

    <style>
        html, body { height: 100%; }

        /* ---------------------------------------------
           TEMAS
        ----------------------------------------------*/

        /* Variáveis padrão (tema fixo) */
        /* :root {
            --color-primary: #00b9a3;
            --sidebar-bg: #212529;
            --sidebar-text: #fff;
            --sidebar-hover: rgba(255,255,255,0.1);
            --main-bg: #343a40;
            --main-text: #fff;
        } */
        
        :root {
            --color-primary: #00b9a3;
            --sidebar-bg: #2c3e50;
            --sidebar-text: #fff;
            --sidebar-hover: rgba(255,255,255,0.1);
            --main-bg: #f8f9fa;
            --main-text: #2c3e50;
        }

        /* ---------------------------------------------
           SIDEBAR
        ----------------------------------------------*/
        .sidebar {
            width: 280px;
            transition: width .2s ease-in-out;
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            height: 100vh;
        }

        .nav-link {
            color: var(--sidebar-text) !important;
            border-radius: .5rem;
            padding: .6rem .8rem;
        }

        .nav-link:hover {
            background-color: var(--sidebar-hover);
        }

        .nav-link.active {
            background-color: var(--color-primary) !important;
            color: #fff !important;
        }

        .nav-link .bi { margin-right: .6rem; }

        .profile-area { margin-top: auto; }

        .divider { opacity: .2; }

        /* ---------------------------------------------
           COLAPSADA
        ----------------------------------------------*/
        .sidebar-collapsed .sidebar { width: 72px; }
        .sidebar-collapsed .sidebar .label-text { display: none; }
        .sidebar-collapsed .sidebar .brand-title { display: none; }
        .sidebar-collapsed .sidebar .nav-link { justify-content: center; }
        .sidebar-collapsed .sidebar .nav-link .bi { margin-right: 0; }
        .sidebar-collapsed .sidebar .profile-area strong { display: none; }
        .sidebar-collapsed .sidebar .profile-area .dropdown-toggle::after { display: none; }

        /* ---------------------------------------------
           MAIN CONTENT
        ----------------------------------------------*/
        body {
            background-color: var(--main-bg);
            color: var(--main-text);
        }

        .toggle-btn { border-color: rgba(255,255,255,.25); color: var(--sidebar-text); }
        .toggle-btn:hover { background: var(--sidebar-hover); }

        /* Estilos padrão solicitados */
        .navbar-brand { font-weight: bold; color: #00b9a3 !important; }
        .card { margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card-header { background-color: #00b9a3; color: #fff; font-weight: bold; }
        .btn-primary { background-color: #00b9a3; border-color: #00b9a3; }
        .btn-primary:hover { background-color: #009982; border-color: #009982; }
        .balance-positive { color: #28a745; font-weight: bold; }
        .balance-negative { color: #dc3545; font-weight: bold; }
        .dropdown-menu { border-radius: 8px; border: 1px solid #e3e3e3; }
        .dropdown-item:hover { background-color: #e8f8f6; }
        .nav-link.dropdown-toggle { color: var(--sidebar-text) !important; font-weight: normal; }
    </style>
</head>

<body>
    <div class="d-flex">

        <!-- SIDEBAR -->
        <aside class="sidebar d-flex flex-column p-3">
            
            <!-- TOPO DO MENU -->
            <div class="d-flex align-items-center justify-content-between mb-3">
                <span class="fs-5 fw-semibold brand-title">Carteira</span>
                <button class="btn btn-sm toggle-btn" id="sidebarToggle">
                    <i class="bi bi-list"></i>
                </button>


                <!-- Botão de tema removido -->
            </div>

            <!-- MENUS -->
            <ul class="nav nav-pills flex-column mb-4">

                <li class="nav-item">
                    <a href="{% url 'contas:index' %}" class="nav-link d-flex align-items-center">
                        <i class="bi bi-house"></i>
                        <span class="label-text">Início</span>
                    </a>
                </li>

                {% if request.user.is_authenticated %}

                <li>
                    <a href="{% url 'carteira:dashboard' %}" class="nav-link d-flex align-items-center">
                        <i class="bi bi-speedometer2"></i>
                        <span class="label-text">Dashboard</span>
                    </a>
                </li>

                <li>
                    <a href="{% url 'carteira:create_operacao' %}" class="nav-link d-flex align-items-center">
                        <i class="bi bi-plus-lg"></i>
                        <span class="label-text">Adicionar Operação</span>
                    </a>
                </li>

                <li>
                    <a href="{% url 'carteira:create_acao' %}" class="nav-link d-flex align-items-center">
                        <i class="bi bi-briefcase"></i>
                        <span class="label-text">Adicionar Ativo</span>
                    </a>
                </li>

                <li>
                    <a href="{% url 'carteira:posicoes' %}" class="nav-link d-flex align-items-center">
                        <i class="bi bi-table"></i>
                        <span class="label-text">Listar Posições</span>
                    </a>
                </li>

                <li class="nav-item dropdown dropend">
                    <a class="nav-link d-flex align-items-center dropdown-toggle" href="#" data-bs-toggle="dropdown">
                        <i class="bi bi-briefcase"></i>
                        <span class="label-text">Cadastrar Ativo</span>
                    </a>

                    <ul class="dropdown-menu dropdown-menu-dark shadow">
                        <li>
                            <a href="{% url 'carteira:create_acao' %}" class="dropdown-item">
                                Cadastrar Ação
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'carteira:create_opcao' %}" class="dropdown-item">
                                Cadastrar Opção
                            </a>
                        </li>
                    </ul>
                </li>

                {% else %}

                <li>
                    <a href="{% url 'account_login' %}" class="nav-link d-flex align-items-center">
                        <i class="bi bi-box-arrow-in-right"></i>
                        <span class="label-text">Login</span>
                    </a>
                </li>

                <li>
                    <a href="{% url 'account_signup' %}" class="nav-link d-flex align-items-center">
                        <i class="bi bi-person-plus"></i>
                        <span class="label-text">Registrar</span>
                    </a>
                </li>

                {% endif %}

            </ul>

            <hr class="divider">

            <!-- ÁREA DO USUÁRIO NO RODAPÉ -->
            <div class="profile-area dropdown mt-auto">

                {% if request.user.is_authenticated %}
                <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle text-white"
                   data-bs-toggle="dropdown">

                    <img src="https://i.pravatar.cc/40?u={{ request.user.email }}" width="32" height="32"
                         class="rounded-circle me-2">

                    <strong>{{ request.user.username }}</strong>
                </a>

                <ul class="dropdown-menu dropdown-menu-dark text-small shadow">
                    <li><a class="dropdown-item" href="#">Perfil</a></li>
                    <li><a class="dropdown-item" href="#">Configurações</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item text-danger fw-bold" href="{% url 'account_logout' %}">Sair</a></li>
                </ul>

                {% else %}
                <a href="{% url 'account_login' %}" class="nav-link text-white d-flex align-items-center">
                    <i class="bi bi-box-arrow-in-right"></i>
                    <span class="label-text">Login</span>
                </a>
                {% endif %}
            </div>

        </aside>

        <!-- CONTEÚDO PRINCIPAL -->
        <main class="flex-grow-1 p-4">
            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        /* ---------------------- SIDEBAR COLLAPSE ------------------------ */
        const body = document.body;
        const btn = document.getElementById('sidebarToggle');
        const collapseKey = 'sidebar-collapsed';

        if (localStorage.getItem(collapseKey) === '1') {
            body.classList.add('sidebar-collapsed');
        }

        btn.addEventListener('click', () => {
            body.classList.toggle('sidebar-collapsed');
            localStorage.setItem(collapseKey, body.classList.contains('sidebar-collapsed') ? '1' : '0');
        });
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>
