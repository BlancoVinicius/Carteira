{% extends "base.html" %}
{% load humanize %}

{% block itens_menu_suspenso %}
    <li>
        <a class="dropdown-item bg-success text-white" href="{% url "carteira:dashboard" %}">Dashboard</a>
    </li>

    <li>
        <a class="dropdown-item" href="{% url "carteira:create_operacao" %}">Adicionar Operação</a>
    </li>

    <li>
        <a class="dropdown-item" href="{% url "carteira:create_acao" %}">Adicionar Ativo</a>
    </li>

    <li>
        <a class="dropdown-item" href="{% url "carteira:posicoes" %}">Listar Posições</a>
    </li>
    
 {% endblock %}


{% block content %}
<div class="container">
    <h3 class="mb-4">Resumo da Carteira</h3>

    <!-- Cards de resumo -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6>Total Investido</h6>
                    <h4>R$ {{ resumo.valor_investido|floatformat:2|intcomma }}</h4>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6>Valor Carteira</h6>
                    <h4>R$ {{ resumo.valor_atual|floatformat:2|intcomma }}</h4>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6>Lucro / Prejuízo</h6>
                    <h4 class="{% if resumo.lucro >= 0 %}balance-positive{% else %}balance-negative{% endif %}">
                        R$ {{ resumo.lucro|floatformat:2|intcomma }}
                    </h4>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6>Rendimento</h6>
                    <h4>{{ resumo.percentual|floatformat:2|intcomma }}%</h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabela de posições -->
    <div class="card mb-4">
        <div class="card-header">Posições Atuais</div>
        <div class="card-body table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Ativo</th>
                        <th>Qtd</th>
                        <th>Preço Médio</th>
                        <th>Preço Atual</th>
                        <th>Lucro</th>
                        <th>Variação (%)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in posicoes %}
                    <tr>
                        <td>{{ p.ativo }}</td>
                        <td>{{ p.quantidade|floatformat:0 }}</td>
                        <td>R$ {{ p.preco_medio|floatformat:2|intcomma }}</td>
                        <td>R$ {{ p.preco_atual|floatformat:2|intcomma }}</td>
                        <td class="{% if p.lucro >= 0 %}balance-positive{% else %}balance-negative{% endif %}">
                            R$ {{ p.lucro|floatformat:2|intcomma }}
                        </td>
                        <td>{{ p.percentual|floatformat:1 }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Últimas operações -->
    <div class="card">
        <div class="card-header">Últimas Operações</div>
        <ul class="list-group list-group-flush">
            {% for op in ultimas_operacoes %}
            <li class="list-group-item">
                {{ op.data|date:"d/m/Y" }} - {{ op.tipo }} {{ op.quantidade }} {{ op.ativo }} a R$ {{ op.preco }}
            </li>
            {% empty %}
            <li class="list-group-item text-center text-muted">Nenhuma operação recente</li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}
